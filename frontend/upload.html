<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ink Insights — Upload</title>
<link rel="icon" href="assests/Ink-logo.png" type="image/png" />

<!-- === STYLES === -->
<style>
  :root {
    --dark-teal:#005A63; --teal:#257881;
    --warm-green:#517A06; --warm-green-20:rgba(81,122,6,.20);
    --pink:#FF2092; --pink-20:rgba(255,32,146,.20);
    --blue:#00A6FF; --blue-30:rgba(0,166,255,.30);
    --light-grey:#DBDBDB; --dark-grey:#737373; --white:#FFFFFF;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:"Droid Serif", Georgia, serif;color:#122022;background:#fff;line-height:1.55}
  a{text-decoration:none;color:inherit}
  /* header */
  .navbar{background:var(--dark-teal);color:#fff;position:sticky;top:0;z-index:40;}
  .nav-inner{display:flex;align-items:center;justify-content:space-between;padding:12px 24px}
  .brand a{display:flex;align-items:center;gap:10px}
  .brand img{width:54px;height:auto}
  .navlinks{display:flex;gap:28px;justify-content:center;flex:1}
  .navlinks a{color:#fff;font-family:"Rockwell","Courier New";font-weight:700;position:relative;}
  .nav-cta{background:#fff;color:var(--dark-teal);padding:10px 18px;border-radius:28px;font-weight:500}
  .nav-cta:hover{background:#000;color:#fff}
  .wrap{max-width:1000px;margin:24px auto;padding:0 18px}
  .title{font-family:"Rockwell";font-size:64px;margin:14px 0;color:#000;text-shadow:0 2px 0 #ccc}
  .divider{border-top:4px dashed var(--warm-green);margin:10px 0 18px}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:28px}
  @media(max-width:900px){.grid{grid-template-columns:1fr}}

  /* Cards */
  .card{background:#fff;border-radius:18px;padding:18px;box-shadow:0 10px 24px rgba(0,0,0,.06)}
  .card.blue{border:3px dashed var(--blue)}
  .card.pink{border:3px dashed var(--pink)}

  /* Dropzone */
  .dropzone{border:3px solid var(--warm-green);border-radius:14px;min-height:300px;display:flex;align-items:center;justify-content:center;text-align:center;transition:.2s;background:#fff}
  .dz-stack{display:flex;flex-direction:column;align-items:center;gap:18px}
  .dz-text{color:#d9d9d9;font-size:44px;font-family:Georgia,serif}
  .dropzone.drag{background:var(--warm-green-20)}
  .select-btn{background:#7aa053;color:#fff;border:2px solid #5e7f3e;border-radius:26px;padding:10px 18px;font-weight:700;cursor:pointer}
  .select-btn:hover{background:#6a8f49}
  input[type=file]{display:none}

  .meta-list{margin-top:16px;display:flex;flex-direction:column;gap:10px}
  .badge{display:inline-flex;align-items:center;gap:8px;padding:8px 14px;border-radius:18px;border:2px dashed;font-family:"Rockwell"}
  .badge.file{border-color:#517A06;color:#517A06}
  .badge.words{border-color:#FF2092;color:#FF2092}

  .cta-row{text-align:center;margin-top:16px}
  .get-btn{background:var(--blue-30);color:var(--blue);border:2px dashed var(--blue);padding:14px 30px;border-radius:26px;cursor:pointer;font-family:"Rockwell"}
  .get-btn:hover{background:var(--blue);color:#fff;transform:translateY(-1px)}
  .get-btn[disabled]{background:#ddd;color:#888;border-color:#ccc;cursor:not-allowed}
</style>
</head>

<body>
<header class="navbar">
  <div class="nav-inner">
    <div class="brand">
      <a href="index.html"><img src="assests/Ink-logo.png" alt="Ink Insights Logo" /><span>Ink Insights</span></a>
    </div>
    <nav class="navlinks">
      <a href="index.html">Home</a>
      <a href="dashboard.html">Dashboard</a>
      <a href="about.html">About</a>
      <a href="faq.html">FAQ</a>
      <a href="contact.html">Contact</a>
    </nav>
    <a class="nav-cta" href="upload.html">START ANALYSIS</a>
  </div>
</header>

<main class="wrap">
  <h1 class="title">Upload</h1>
  <div class="divider"></div>

  <section class="grid">
    <!-- Instructions -->
    <article class="card blue">
      <h2>Instructions</h2>
      <ol>
        <li>Drag &amp; drop or select the text file you want to analyze.</li>
        <li>Click “Get Results.”</li>
      </ol>
      <p>The word limit is <strong>5,000</strong> words per upload.</p>
    </article>

    <!-- Upload box -->
    <div>
      <div id="dropzone" class="dropzone">
        <div class="dz-stack">
          <div class="dz-text">Drag &amp; drop your<br>file here</div>
          <label class="select-btn" for="fileInput">SELECT FILE ＋</label>
          <input id="fileInput" type="file" accept=".txt">
        </div>
      </div>

      <div class="meta-list">
        <span class="badge file">File Name: <span id="fileName">—</span></span>
        <span class="badge words">Word Count: <span id="wordCount">0</span></span>
      </div>

      <div class="cta-row">
        <button id="resultsBtn" class="get-btn" disabled>GET RESULTS ▸</button>
      </div>
    </div>

    <!-- Security note -->
    <article class="card pink">
      <h2>Rest Assured!</h2>
      <p>✅ Your text is automatically deleted after analysis.<br>
      ✅ We never store or share your content.<br>
      ✅ Your data stays private and secure.</p>
    </article>
  </section>
</main>

<!-- === SCRIPT === -->
<script>
(function(){
  const els = {
    drop: document.getElementById('dropzone'),
    fileInput: document.getElementById('fileInput'),
    fileName: document.getElementById('fileName'),
    wordCount: document.getElementById('wordCount'),
    resultsBtn: document.getElementById('resultsBtn')
  };

  function countWords(t){ return (t.match(/\b[\p{L}\p{N}’'-]+\b/gu)||[]).length; }

  function handleFile(file){
    if(!/\.txt$/i.test(file.name)){ alert('Please upload only .txt files.'); return; }
    const reader = new FileReader();
    reader.onload = e=>{
      const text = e.target.result || '';
      const words = countWords(text);
      els.fileName.textContent = file.name;
      els.wordCount.textContent = words.toLocaleString();
      const ok = (words && words<=5000);
      els.resultsBtn.disabled = !ok;
      localStorage.setItem('ink_text', text);
      localStorage.setItem('ink_report_meta', JSON.stringify({name:file.name, words}));
    };
    reader.readAsText(file);
  }

  // Drag/drop
  ['dragenter','dragover'].forEach(evt=>{
    els.drop.addEventListener(evt, e=>{ e.preventDefault(); els.drop.classList.add('drag'); });
  });
  ['dragleave','drop'].forEach(evt=>{
    els.drop.addEventListener(evt, e=>{ e.preventDefault(); els.drop.classList.remove('drag'); });
  });
  els.drop.addEventListener('drop', e=>{
    const f = e.dataTransfer.files?.[0];
    if(f) handleFile(f);
  });
  els.fileInput.addEventListener('change', ()=>{
    const f = els.fileInput.files?.[0];
    if(f) handleFile(f);
  });

  // Submit to backend
  els.resultsBtn.addEventListener('click', async ()=>{
    if(els.resultsBtn.disabled) return;
    els.resultsBtn.textContent = "Analyzing...";
    els.resultsBtn.disabled = true;

    const text = localStorage.getItem('ink_text') || '';
    try {
      const response = await fetch('https://ink-insights-api.onrender.com/analyze', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({ text })
      });
      if (!response.ok) throw new Error('Server error');
      const data = await response.json();
      localStorage.setItem('ink_results', JSON.stringify(data));
      window.location.href = 'dashboard.html';
    } catch (err) {
      alert('Something went wrong while analyzing your text.');
      console.error(err);
      els.resultsBtn.textContent = "GET RESULTS ▸";
      els.resultsBtn.disabled = false;
    }
  });
})();
</script>
</body>
</html>
