<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ink Insights — Dashboard</title>

<!-- Chart.js (for charts) -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>

<style>
  :root{
    --teal:#0b6b6f;
    --teal-dark:#0a4c50;
    --ink:#082c2f;
    --lav:#b9a8ff;         /* subtle lilac edge (top/left) */
    --edge:#173c43;        /* darker edge (bottom/right) */
    --muted:#5b7073;
    --card-bg:#ffffff;
    --grid-gap:28px;
  }
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{font-family:"Poppins",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:#fff;color:var(--ink);line-height:1.6}
  html{scroll-behavior:smooth}

  /* Navbar */
  .navbar{
    background:var(--teal);
    color:#fff;
    padding:16px 5vw;
    display:flex;align-items:center;justify-content:space-between;
  }
  .brand{display:flex;align-items:center;gap:10px}
  .brand-logo{width:44px;height:auto}
  .brand-text{font-weight:700;font-size:1.4rem}
  .navlinks{display:flex;align-items:center;gap:24px}
  .navlinks a{color:#fff;text-decoration:none;font-weight:500}
  .navlinks a:hover{opacity:.88}
  .nav-cta{padding:10px 16px;border-radius:22px;background:#e6f1f2;color:var(--teal);font-weight:700}
  .divider-thin{height:6px;background:#e9f7f7}

  /* Page container */
  .wrap{padding:28px 6vw 60px}

  /* Header block */
  .dash-title{font-size:2.4rem;font-weight:800;margin-bottom:8px}
  .meta{color:#1c4ed8;font-weight:600;letter-spacing:.4px;margin-bottom:18px}
  .meta span{display:inline-block; min-width:9.5ch}

  /* Grid of cards */
  .grid{
    display:grid;
    grid-template-columns: repeat(2, minmax(280px, 1fr));
    gap:var(--grid-gap);
    align-items:stretch;
  }
  .card{
    background:var(--card-bg);
    border-top:3px solid var(--lav);
    border-left:3px solid var(--lav);
    border-right:6px solid var(--edge);
    border-bottom:6px solid var(--edge);
    border-radius:10px;
    display:flex;flex-direction:column;
    min-height:280px;
  }
  .card-header{
    padding:12px 14px 6px;
    text-align:center;
    color:var(--teal);
    font-weight:700;
    font-size:1.1rem;
  }
  .card-body{
    padding:8px 14px 16px;
    flex:1;
    display:flex;align-items:center;justify-content:center;
  }
  .card-body canvas{width:100% !important; height:100% !important; max-height:360px}
  .pillbox{
    display:flex;flex-wrap:wrap;gap:10px;justify-content:center;align-content:flex-start;
    width:100%;
  }
  .pill{
    border:1.5px dashed var(--teal);
    color:var(--teal-dark);
    padding:6px 10px;border-radius:999px;
    font-weight:600;background:#f7fbfb;
  }
  .empty{color:var(--muted);font-style:italic}

  @media (max-width: 980px){
    .grid{grid-template-columns:1fr}
  }
</style>
</head>
<body>

<!-- NAV -->
<header class="navbar">
  <div class="brand">
    <img src="assests/Ink-Logo.png" alt="Ink Insights logo" class="brand-logo" />
    <span class="brand-text">Ink Insights</span>
  </div>
  <nav class="navlinks">
    <a href="index.html#home">Home</a>
    <a href="reports.html">Reports</a>
    <a href="about.html">About Us</a>
    <a href="faq.html">FAQ/Help</a>
    <a class="nav-cta" href="Analysis.html" style="color:#005a63; font-weight:700; text-decoration:none;">START ANALYSIS</a>
  </nav>
</header>
<div class="divider-thin"></div>

<!-- DASHBOARD -->
<main class="wrap">
  <h1 class="dash-title">Dashboard</h1>
  <div class="meta">
    <div><span>File Name:</span> <span id="fileName">—</span></div>
    <div><span>Word Count:</span> <span id="wordCount">—</span></div>
  </div>

  <section class="grid" aria-label="Report panels">
    <!-- 1) Keyword & Frequencies -->
    <article class="card">
      <h2 class="card-header">Keyword &amp; Frequencies</h2>
      <div class="card-body">
        <canvas id="kwChart" aria-label="Keyword frequency chart"></canvas>
        <div id="kwFallback" class="empty" hidden>No chart library. Top keywords will appear here.</div>
      </div>
    </article>

    <!-- 2) Themes & Clusters -->
    <article class="card">
      <h2 class="card-header">Themes &amp; Clusters</h2>
      <div class="card-body">
        <div id="clusterWrap" class="pillbox" aria-label="Theme clusters">
          <span class="empty">Waiting for themes…</span>
        </div>
      </div>
    </article>

    <!-- 3) Sentiment Overview -->
    <article class="card">
      <h2 class="card-header">Sentiment Overview</h2>
      <div class="card-body">
        <canvas id="sentChart" aria-label="Sentiment chart"></canvas>
        <div id="sentFallback" class="empty" hidden>Positive / Neutral / Negative will show here.</div>
      </div>
    </article>

    <!-- 4) Emotional Patterns -->
    <article class="card">
      <h2 class="card-header">Emotional Patterns</h2>
      <div class="card-body">
        <canvas id="emoChart" aria-label="Emotion radar chart"></canvas>
        <div id="emoFallback" class="empty" hidden>Emotion scores will appear here.</div>
      </div>
    </article>
  </section>
</main>

<script>
(function(){
  const hasChartJS = !!window.Chart;

  const els = {
    fileName: document.getElementById('fileName'),
    wordCount: document.getElementById('wordCount'),
    kwCanvas: document.getElementById('kwChart'),
    kwFallback: document.getElementById('kwFallback'),
    sentCanvas: document.getElementById('sentChart'),
    sentFallback: document.getElementById('sentFallback'),
    emoCanvas: document.getElementById('emoChart'),
    emoFallback: document.getElementById('emoFallback'),
    clusterWrap: document.getElementById('clusterWrap')
  };

  let charts = {kw:null, sent:null, emo:null};

  function renderKeywords(list){
    if(!list || !list.length){ showText(els.kwFallback, "No keywords found."); return; }
    const labels = list.map(d => d.term);
    const data = list.map(d => d.count);
    if(hasChartJS){
      charts.kw && charts.kw.destroy();
      charts.kw = new Chart(els.kwCanvas, {
        type: 'bar',
        data: {
          labels,
          datasets: [{label:"Frequency", data, borderWidth:1}]
        },
        options: {
          responsive:true,
          plugins:{legend:{display:false}},
          scales:{y:{beginAtZero:true}}
        }
      });
      els.kwFallback.hidden = true;
    } else {
      showText(els.kwFallback, labels.map((t,i)=>`${i+1}. ${t} — ${data[i]}`).join("   "));
    }
  }

  function renderClusters(clusters){
    const wrap = els.clusterWrap;
    wrap.innerHTML = '';
    if(!clusters || !clusters.length){
      wrap.innerHTML = '<span class="empty">No clusters.</span>';
      return;
    }
    clusters.forEach(group=>{
      const span = document.createElement('span');
      span.className = 'pill';
      span.textContent = group.join(' • ');
      wrap.appendChild(span);
    });
  }

  function renderSentiment(obj){
    if(!obj){ showText(els.sentFallback,"No sentiment data."); return; }
    const labels = ['Positive','Neutral','Negative'];
    const data = [obj.positive||0, obj.neutral||0, obj.negative||0];
    if(hasChartJS){
      charts.sent && charts.sent.destroy();
      charts.sent = new Chart(els.sentCanvas, {
        type:'doughnut',
        data:{labels, datasets:[{data}]},
        options:{
          responsive:true,
          plugins:{legend:{position:'bottom'}}
        }
      });
      els.sentFallback.hidden = true;
    } else {
      showText(els.sentFallback, `${labels[0]}: ${pct(data[0])}   ${labels[1]}: ${pct(data[1])}   ${labels[2]}: ${pct(data[2])}`);
    }
  }

  function renderEmotions(obj){
    if(!obj){ showText(els.emoFallback,"No emotion data."); return; }
    const labels = Object.keys(obj);
    const data = labels.map(k => obj[k]||0);
    if(hasChartJS){
      charts.emo && charts.emo.destroy();
      charts.emo = new Chart(els.emoCanvas, {
        type:'radar',
        data:{labels, datasets:[{label:'Intensity', data, fill:true}]},
        options:{
          responsive:true,
          plugins:{legend:{display:false}},
          scales:{r:{beginAtZero:true, max:1}}
        }
      });
      els.emoFallback.hidden = true;
    } else {
      showText(els.emoFallback, labels.map((k,i)=>`${k}: ${pct(data[i])}`).join('   '));
    }
  }

  function showText(el, text){
    el.hidden = false;
    el.textContent = text;
  }
  function pct(v){ return Math.round((v||0)*100) + '%'; }

  // Expose to global so your backend can call it later
  window.loadReport = function(data){
    try{
      els.fileName.textContent = data.fileName || '—';
      els.wordCount.textContent = formatInt(data.wordCount);
      renderKeywords((data.keywords || []).slice(0, 12));
      renderClusters(data.clusters || []);
      renderSentiment(data.sentiment || null);
      renderEmotions(data.emotions || null);
    }catch(e){
      console.error('loadReport error:', e);
    }
  };

  function formatInt(v){
    return (typeof v === 'number' && Number.isFinite(v)) ? v.toLocaleString() : '—';
  }

  // Use saved meta (from Analysis) for file name/word count; keep demo for charts until backend is wired
  function getSavedMeta(){
    try { return JSON.parse(localStorage.getItem('ink_report_meta') || 'null'); }
    catch { return null; }
  }

  window.addEventListener('DOMContentLoaded', () => {
    const demo = {
      fileName: "sample.txt",
      wordCount: 1520,
      keywords: [
        {term:"river",count:22},{term:"night",count:18},{term:"home",count:15},
        {term:"north",count:12},{term:"wind",count:11},{term:"road",count:9},
        {term:"family",count:8},{term:"water",count:8},{term:"time",count:7}
      ],
      clusters: [
        ["family","home","belonging"],
        ["journey","river","north"],
        ["memory","time","change"]
      ],
      sentiment: {positive:0.48, neutral:0.37, negative:0.15},
      emotions: {joy:0.62, sadness:0.22, anger:0.06, fear:0.11, surprise:0.18, disgust:0.03}
    };

    const meta = getSavedMeta();
    if(meta){
      if (meta.fileName) demo.fileName = meta.fileName;
      if (typeof meta.wordCount === 'number') demo.wordCount = meta.wordCount;
      // optional: clear after use
      // localStorage.removeItem('ink_report_meta');
    }

    loadReport(demo);
  });
})();
</script>
</body>
</html>
